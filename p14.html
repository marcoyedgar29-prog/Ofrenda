<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Ofrenda Día de Muertos - Pixel Art</title>
	<style>
		:root{
			--bg:#0b0220;
		}
		html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,Segoe UI,Roboto;}
		.container{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;gap:12px;color:#fff;text-align:center;}
		/* mantengo canvas-wrap relativo para overlay decorativo */
		.canvas-wrap{background:linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.5));padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.6); position:relative; overflow:hidden;}
		canvas{display:block;background:transparent;image-rendering:pixelated;border:6px solid rgba(255,255,255,.06);border-radius:6px;}
		.controls{display:flex;gap:8px;align-items:center;justify-content:center;}
		label{font-size:13px;opacity:.9}
		input[type="range"]{width:220px;}
		.credit{font-size:12px;opacity:.8}
		/* --- Nuevo: estilos para bombillas decorativas --- */
		.bulb {
			position: absolute;
			width: 8px;
			height: 8px;
			border-radius: 50%;
			opacity: 0.9;
			pointer-events: none;
			animation: flicker 3s infinite alternate;
		}
		@keyframes flicker {
			from { opacity: 0.9; }
			to { opacity: 0.4; }
		}
	</style>
	<link rel="stylesheet" href="./decoracion.css">
</head>
<body>
	<div class="container">
		<h1>Ofrenda - Pixel Art</h1>
		<div class="canvas-wrap">
			<canvas id="pxc"></canvas>
			<!-- overlay para confetti/partículas y decoraciones -->
			<div class="decor-overlay" id="decor" aria-hidden="true"></div>
		</div>
		<div class="controls">
			<label for="scale">Escala</label>
			<input id="scale" type="range" min="4" max="14" value="8">
			<button id="redraw">Redibujar</button>
		</div>
		<div class="credit">Colorida ofrenda pixel art con calavera, velas, flores y papel picado</div>
	</div>

	<script>
		// Restaurado: configuración del "lienzo lógico" original (pixel art pequeño)
		const W = 80, H = 60;
		const canvas = document.getElementById('pxc');
		const ctx = canvas.getContext('2d');
		canvas.width = W;
		canvas.height = H;
		ctx.imageSmoothingEnabled = false;

		const palette = {
			bg1: "#1b0233", bg2: "#2b0b5b",
			papel1: "#ff2d95", papel2: "#ffd23f", papel3: "#33d6ff",
			altar: "#6a3b18", altar2: "#c96e1a",
			marigold1: "#ff9d00", marigold2: "#ffd400",
			candle: "#fff9cc", flame1: "#ffd23f", flame2: "#ff6b00",
			skull: "#ffffff", skullDec: "#d44c9c", eye: "#0b3d6b",
			bread: "#8c4b2f", breadDec:"#d99f73",
			fruit1:"#ff3864", fruit2:"#4cd97b", fruit3:"#ff8c1a",
			leaf:"#2f8b3e", dark:"#000000"
		};

		// Helpers mínimos
		function setPixel(x,y,color){ ctx.fillStyle = color; ctx.fillRect(x,y,1,1); }
		function rect(x,y,w,h,color){ ctx.fillStyle = color; ctx.fillRect(x,y,w,h); }
		function circle(cx,cy,r,color){
			ctx.fillStyle = color;
			for(let y=Math.floor(cy-r); y<=Math.ceil(cy+r); y++){
				for(let x=Math.floor(cx-r); x<=Math.ceil(cx+r); x++){
					if((x-cx)*(x-cx)+(y-cy)*(y-cy) <= r*r) ctx.fillRect(x,y,1,1);
				}
			}
		}
		function hline(x,y,w,color){ rect(x,y,w,1,color); }
		function vline(x,y,h,color){ rect(x,y,1,h,color); }

		// ---------- Reemplazo: fondo dinámico usando HSL (sustituye la versión previa drawBackground) ----------
		// helper HSL -> RGB (devuelve objeto {r,g,b})
		function hslToRgb(h, s, l){
			s /= 100; l /= 100;
			const k = n => (n + h/30) % 12;
			const a = s * Math.min(l, 1 - l);
			const f = n => l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));
			return { r: Math.round(255 * f(0)), g: Math.round(255 * f(8)), b: Math.round(255 * f(4)) };
		}

		let _huePhase = 0;
		function drawBackground(){
			// dos tonos HSL ligados a la fase para obtener cambio de color
			const h1 = (_huePhase) % 360;
			const h2 = (_huePhase + 28) % 360;
			const c1 = hslToRgb(h1, 65, 8);
			const c2 = hslToRgb(h2, 65, 18);
			for(let y=0;y<H;y++){
				const t = y / (H-1);
				const r = Math.round(c1.r + (c2.r - c1.r)*t);
				const g = Math.round(c1.g + (c2.g - c1.g)*t);
				const b = Math.round(c1.b + (c2.b - c1.b)*t);
				hline(0,y,W,`rgb(${r},${g},${b})`);
			}
		}

		// ---------- Nuevas calaveritas pequeñas ----------
		function drawMiniSkull(cx,cy,accent){
			const r = 2;
			circle(cx,cy,r,palette.skull);
			setPixel(cx-1,cy-1,palette.eye);
			setPixel(cx+1,cy-1,palette.eye);
			setPixel(cx,cy+1,palette.dark);
			if(accent) setPixel(cx,cy-1,accent);
		}
		function drawTinySkull(cx,cy,accent){
			setPixel(cx,cy,palette.skull);
			setPixel(cx-1,cy,palette.skull);
			setPixel(cx,cy-1,palette.eye);
			if(accent) setPixel(cx-1,cy-1,accent);
		}

		// ---------- Calaveritas en el fondo (cielo) ----------
		const bgSkulls = [];
		function populateBackgroundSkulls(count = 20){
			bgSkulls.length = 0;
			for(let i=0;i<count;i++){
				bgSkulls.push({
					x: 4 + Math.floor(Math.random()*(W-8)),
					y: 6 + Math.floor(Math.random()*(Math.floor(H*0.45)-6)),
					size: (Math.random()<0.6)?'mini':'tiny',
					hueOffset: Math.random()*80 - 40
				});
			}
		}
		function drawBackgroundSkulls(){
			bgSkulls.forEach(s=>{
				const hue = (_huePhase + s.hueOffset + 50) % 360;
				const colrgb = hslToRgb(hue, 70, 60);
				const accent = `rgba(${colrgb.r},${colrgb.g},${colrgb.b},0.95)`;
				if(s.size === 'mini') drawMiniSkull(s.x, s.y, accent);
				else drawTinySkull(s.x, s.y, accent);
			});
		}

		// ---------- Más calaveritas sobre/alrededor del altar ----------
		function drawMoreSkullsOnAltar(){
			const coords = [
				[8,38],[12,37],[16,36],[20,36],[24,35],[28,34],
				[34,32],[40,30],[46,30],[52,32],[58,34],[64,36],[70,36]
			];
			coords.forEach((p,i)=>{
				if(i % 2 === 0) drawMiniSkull(p[0], p[1], (i%3===0)?palette.skullDec:palette.papel2);
				else drawTinySkull(p[0], p[1], (i%3===1)?palette.papel1:palette.papel3);
			});
			// unos toques sobre ofrendas
			drawMiniSkull(30,34,palette.papel2);
			drawMiniSkull(52,35,palette.papel3);
		}

		// ---------- Animación continua ----------
		let _lastTS = 0;
		function animate(ts){
			if(!_lastTS) _lastTS = ts;
			const dt = ts - _lastTS;
			_lastTS = ts;
			_huePhase = (_huePhase + dt * 0.02) % 360; // velocidad de cambio
			render();
			requestAnimationFrame(animate);
		}

		// ---------- Extender render para incluir calaveritas de fondo y en altar ----------
		function render(){
			ctx.clearRect(0,0,W,H);
			drawBackground();
			drawBackgroundSkulls(); // calaveritas en el cielo
			drawPapelPicado();
			// campo de cempasúchil antes del altar
			drawMarigoldField(0.14);
			drawAltar();
			// calaveritas en altar/ofrenda
			drawMoreSkullsOnAltar();
			drawMarigolds();
			drawCandles();
			drawSkull(); // calavera central
			drawOfferings();
			drawDetails();
		}

		// ---------- Inicialización: poblar fondo y arrancar loop ----------
		// --- Decoración ligera: confetti + pétalos (DOM) ---
		function createConfetti(count = 36){
			const wrap = document.getElementById('decor');
			wrap.innerHTML = '';
			for(let i=0;i<count;i++){
				const e = document.createElement('span');
				e.className = 'confetti';
				e.style.left = (Math.random()*100) + '%';
				e.style.width = e.style.height = (4 + Math.random()*6) + 'px';
				const colors = [palette.papel1,palette.papel2,palette.papel3,palette.marigold1,palette.marigold2];
				e.style.background = colors[Math.floor(Math.random()*colors.length)];
				e.style.animationDelay = (Math.random()*-8) + 's';
				e.style.animationDuration = (6 + Math.random()*6) + 's';
				wrap.appendChild(e);
			}
		}
		function createPetals(count = 18){
			const wrap = document.getElementById('decor');
			for(let i=0;i<count;i++){
				const e = document.createElement('span');
				e.className = 'petal';
				e.style.left = (5 + Math.random()*90) + '%';
				e.style.width = e.style.height = (5 + Math.random()*6) + 'px';
				e.style.background = (Math.random()<0.6)?palette.marigold1:palette.marigold2;
				e.style.animationDelay = (Math.random()*-6) + 's';
				wrap.appendChild(e);
			}
		}
		function createStringLights(count = 14){
			const wrap = document.getElementById('decor');
			// eliminar previas
			Array.from(wrap.querySelectorAll('.bulb')).forEach(n=>n.remove());
			for(let i=0;i<count;i++){
				const b = document.createElement('span');
				b.className = 'bulb';
				// distribuir en arco encima del altar
				const left = 8 + i * (84 / Math.max(1,count-1));
				const wobble = Math.sin(i/2) * 3;
				b.style.left = left + '%';
				b.style.top = (6 + Math.abs(wobble)) + '%';
				// usar color heredable en pseudo mediante currentColor
				const colors = [palette.papel1, palette.papel2, palette.papel3, palette.marigold1];
				const col = colors[Math.floor(Math.random()*colors.length)];
				b.style.color = col; // pseudo-element usará currentColor
				b.style.width = (4 + Math.random()*4) + 'px';
				b.style.height = b.style.width;
				b.style.animationDelay = (Math.random()*-3) + 's';
				wrap.appendChild(b);
			}
		}

		// UI
		const scaleInput = document.getElementById('scale');
		document.getElementById('redraw').addEventListener('click', ()=>{ render(); });
		scaleInput.addEventListener('input', (e)=> applyScale(+e.target.value));

		// inicializar: decor + render
		createConfetti(60); // más festivo
		createPetals(26);
		createStringLights(16);
		populateBackgroundSkulls(28); // generar posiciones aleatorias
		applyScale(+scaleInput.value);
		requestAnimationFrame(animate);
		render();

	</script>
</body>
</html>
