<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Ofrenda Día de Muertos - Pixel Art</title>
	<style>
		:root{
			--bg:#0b0220;
		}
		html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,Segoe UI,Roboto;}
		.container{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;gap:12px;color:#fff;text-align:center;}
		/* mantengo canvas-wrap relativo para overlay decorativo */
		.canvas-wrap{background:linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.5));padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.6); position:relative; overflow:hidden;}
		canvas{display:block;background:transparent;image-rendering:pixelated;border:6px solid rgba(255,255,255,.06);border-radius:6px;}
		.controls{display:flex;gap:8px;align-items:center;justify-content:center;}
		label{font-size:13px;opacity:.9}
		input[type="range"]{width:220px;}
		.credit{font-size:12px;opacity:.8}
		/* --- Nuevo: estilos para bombillas decorativas --- */
		.bulb {
			position: absolute;
			width: 8px;
			height: 8px;
			border-radius: 50%;
			opacity: 0.9;
			pointer-events: none;
			animation: flicker 3s infinite alternate;
		}
		@keyframes flicker {
			from { opacity: 0.9; }
			to { opacity: 0.4; }
		}
	</style>
	<link rel="stylesheet" href="./decoracion.css">
</head>
<body>
	<div class="container">
		<h1>Ofrenda - Pixel Art</h1>
		<div class="canvas-wrap">
			<canvas id="pxc"></canvas>
			<!-- overlay para confetti/partículas y decoraciones -->
			<div class="decor-overlay" id="decor" aria-hidden="true"></div>
		</div>
		<div class="controls">
			<label for="scale">Escala</label>
			<input id="scale" type="range" min="4" max="14" value="8">
			<button id="redraw">Redibujar</button>
		</div>
		<div class="credit">Colorida ofrenda pixel art con calavera, velas, flores y papel picado</div>
	</div>

	<script>
		// Restaurado: configuración del "lienzo lógico" original (pixel art pequeño)
		const W = 80, H = 60;
		const canvas = document.getElementById('pxc');
		const ctx = canvas.getContext('2d');
		canvas.width = W;
		canvas.height = H;
		ctx.imageSmoothingEnabled = false;

		const palette = {
			bg1: "#1b0233", bg2: "#2b0b5b",
			papel1: "#ff2d95", papel2: "#ffd23f", papel3: "#33d6ff",
			altar: "#6a3b18", altar2: "#c96e1a",
			marigold1: "#ff9d00", marigold2: "#ffd400",
			candle: "#fff9cc", flame1: "#ffd23f", flame2: "#ff6b00",
			skull: "#ffffff", skullDec: "#d44c9c", eye: "#0b3d6b",
			bread: "#8c4b2f", breadDec:"#d99f73",
			fruit1:"#ff3864", fruit2:"#4cd97b", fruit3:"#ff8c1a",
			leaf:"#2f8b3e", dark:"#000000"
		};

		// Helpers mínimos
		function setPixel(x,y,color){ ctx.fillStyle = color; ctx.fillRect(x,y,1,1); }
		function rect(x,y,w,h,color){ ctx.fillStyle = color; ctx.fillRect(x,y,w,h); }
		function circle(cx,cy,r,color){
			ctx.fillStyle = color;
			for(let y=Math.floor(cy-r); y<=Math.ceil(cy+r); y++){
				for(let x=Math.floor(cx-r); x<=Math.ceil(cx+r); x++){
					if((x-cx)*(x-cx)+(y-cy)*(y-cy) <= r*r) ctx.fillRect(x,y,1,1);
				}
			}
		}
		function hline(x,y,w,color){ rect(x,y,w,1,color); }
		function vline(x,y,h,color){ rect(x,y,1,h,color); }

		// Restaurado: dibujo original (fondo, papel picado, altar, flores, velas, calavera...)
		function drawBackground(){
			for(let y=0;y<H;y++){
				const t = y / (H-1);
				const c = lerpColor(palette.bg1, palette.bg2, t);
				hline(0,y,W,c);
			}
		}
		function lerpColor(a,b,t){
			const pa = hexToRgb(a), pb = hexToRgb(b);
			const r = Math.round(pa.r + (pb.r-pa.r)*t);
			const g = Math.round(pa.g + (pb.g-pa.g)*t);
			const bl = Math.round(pa.b + (pb.b-pa.b)*t);
			return `rgb(${r},${g},${bl})`;
		}
		function hexToRgb(hex){ hex = hex.replace('#',''); if(hex.length===3) hex = hex.split('').map(c=>c+c).join(''); return {r:parseInt(hex.slice(0,2),16), g:parseInt(hex.slice(2,4),16), b:parseInt(hex.slice(4,6),16)}; }

		function drawPapelPicado(){
			const top = 4;
			for(let i=0;i<8;i++){
				const x = 4 + i*9;
				const color = (i%3===0)?palette.papel1: (i%3===1)?palette.papel2:palette.papel3;
				rect(x,top,8,6,color);
				setPixel(x+2, top+1, palette.dark);
				setPixel(x+5, top+1, palette.dark);
				setPixel(x+3, top+3, palette.dark);
				setPixel(x+4, top+3, palette.dark);
			}
		}

		function drawAltar(){
			rect(6, 42, 68, 8, palette.altar);
			hline(6,41,68,palette.altar2);
			rect(14,34,52,6,palette.altar2);
			hline(14,33,52,palette.altar);
			rect(26,28,28,4,palette.altar);
			hline(26,27,28,palette.altar2);
			for(let i=0;i<8;i++) hline(0,50+i,W,`rgba(0,0,0,${0.03*i})`);
		}

		function drawMarigolds(){
			const clusters = [[10,41],[16,39],[24,38],[36,37],[46,37],[55,37],[64,39]];
			clusters.forEach(([x,y])=>{
				for(let dx=-2;dx<=2;dx++) for(let dy=-2;dy<=2;dy++) if(Math.abs(dx)+Math.abs(dy)<=2){
					const c = (Math.random()<0.6)?palette.marigold1:palette.marigold2;
					setPixel(x+dx,y+dy,c);
				}
			});
		}

		function drawCandles(){
			const candleXs = [18,32,40,48,62];
			candleXs.forEach(x=>{
				for(let h=0; h<5; h++) setPixel(x, 23+h, palette.candle);
				setPixel(x,22,palette.dark);
				setPixel(x,21, palette.flame1);
				setPixel(x,20, palette.flame2);
				setPixel(x-1,21,palette.flame1);
				setPixel(x+1,21,palette.flame1);
			});
		}

		function drawSkull(){
			const cx = 40, cy = 18, r = 7;
			circle(cx,cy,r,palette.skull);
			circle(cx-3,cy-1,2,palette.eye);
			circle(cx+3,cy-1,2,palette.eye);
			setPixel(cx,cy+1,palette.dark);
			hline(cx-3,cy+3,7,palette.dark);
			for(let i=0;i<6;i++){
				const a = Math.PI*(i/3);
				const sx = cx + Math.round(Math.cos(a)*(r+1.2));
				const sy = cy + Math.round(Math.sin(a)*(r+1.0));
				setPixel(sx,sy,palette.skullDec);
			}
		}

		function drawOfferings(){
			circle(30,33,3,palette.bread);
			setPixel(30,33,palette.breadDec);
			circle(50,34,2,palette.fruit1);
			circle(55,34,2,palette.fruit2);
			circle(60,34,2,palette.fruit3);
			setPixel(54,31,palette.leaf);
			setPixel(58,31,palette.leaf);
		}

		function drawDetails(){
			for(let x=12;x<70;x+=6){
				setPixel(x,32,palette.altar2);
				setPixel(x+1,32,palette.altar2);
			}
			setPixel(22,31,palette.candle);
			setPixel(36,29,palette.candle);
			setPixel(52,31,palette.candle);
		}

		// --- Nuevo: pinta un campo denso de cempasúchil en la zona baja del lienzo ---
		function drawMarigoldField(density = 0.12){
			// dibuja muchas manchas pequeñas en la zona frontal/suelo (por debajo de y=46)
			for(let x = 2; x < W-2; x += 2){
				for(let y = 46; y < H-2; y += 2){
					if(Math.random() < density){
						// pequeña mancha/clúster alrededor del punto
						const baseX = x + (Math.random()*3 - 1.5) | 0;
						const baseY = y + (Math.random()*2 - 1) | 0;
						const col = (Math.random() < 0.65) ? palette.marigold1 : palette.marigold2;
						for(let dx = -1; dx <= 1; dx++){
							for(let dy = -1; dy <= 1; dy++){
								if(Math.abs(dx) + Math.abs(dy) <= 2){
									// evita dibujar encima del borde del canvas
									const px = baseX + dx, py = baseY + dy;
									if(px > 0 && px < W-1 && py > 44 && py < H-1) setPixel(px, py, col);
								}
							}
						}
					}
				}
			}
		}

		// --- Nuevo: crear "bombillas" para guirnaldas en overlay ---
		function createStringLights(count = 14){
			const wrap = document.getElementById('decor');
			// eliminar previas
			Array.from(wrap.querySelectorAll('.bulb')).forEach(n=>n.remove());
			for(let i=0;i<count;i++){
				const b = document.createElement('span');
				b.className = 'bulb';
				// distribuir en arco encima del altar
				const left = 8 + i * (84 / Math.max(1,count-1));
				const wobble = Math.sin(i/2) * 3;
				b.style.left = left + '%';
				b.style.top = (6 + Math.abs(wobble)) + '%';
				// usar color heredable en pseudo mediante currentColor
				const colors = [palette.papel1, palette.papel2, palette.papel3, palette.marigold1];
				const col = colors[Math.floor(Math.random()*colors.length)];
				b.style.color = col; // pseudo-element usará currentColor
				b.style.width = (4 + Math.random()*4) + 'px';
				b.style.height = b.style.width;
				b.style.animationDelay = (Math.random()*-3) + 's';
				wrap.appendChild(b);
			}
		}

		function render(){
			ctx.clearRect(0,0,W,H);
			drawBackground();
			drawPapelPicado();
			// pintar primero el campo de cempasúchil (queda debajo del altar)
			drawMarigoldField(0.14);
			
			drawAltar();
			drawMarigolds();
			drawCandles();
			drawSkull();
			drawOfferings();
			drawDetails();
		}

		function applyScale(s){
			canvas.style.width = (W*s) + 'px';
			canvas.style.height = (H*s) + 'px';
		}

		// --- Decoración ligera: confetti + pétalos (DOM) ---
		function createConfetti(count = 36){
			const wrap = document.getElementById('decor');
			wrap.innerHTML = '';
			for(let i=0;i<count;i++){
				const e = document.createElement('span');
				e.className = 'confetti';
				e.style.left = (Math.random()*100) + '%';
				e.style.width = e.style.height = (4 + Math.random()*6) + 'px';
				const colors = [palette.papel1,palette.papel2,palette.papel3,palette.marigold1,palette.marigold2];
				e.style.background = colors[Math.floor(Math.random()*colors.length)];
				e.style.animationDelay = (Math.random()*-8) + 's';
				e.style.animationDuration = (6 + Math.random()*6) + 's';
				wrap.appendChild(e);
			}
		}
		function createPetals(count = 18){
			const wrap = document.getElementById('decor');
			for(let i=0;i<count;i++){
				const e = document.createElement('span');
				e.className = 'petal';
				e.style.left = (5 + Math.random()*90) + '%';
				e.style.width = e.style.height = (5 + Math.random()*6) + 'px';
				e.style.background = (Math.random()<0.6)?palette.marigold1:palette.marigold2;
				e.style.animationDelay = (Math.random()*-6) + 's';
				wrap.appendChild(e);
			}
		}

		// UI
		const scaleInput = document.getElementById('scale');
		document.getElementById('redraw').addEventListener('click', ()=>{ render(); });
		scaleInput.addEventListener('input', (e)=> applyScale(+e.target.value));

		// inicializar: decor + render
		createConfetti(60); // más festivo
		createPetals(26);
		createStringLights(16);
		applyScale(+scaleInput.value);
		render();

	</script>
</body>
</html>
